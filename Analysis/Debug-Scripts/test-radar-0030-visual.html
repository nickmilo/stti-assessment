<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radar Chart Debug - Code 0030</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            padding: 40px;
            background: #1a1a1a;
            color: #fff;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        .chart-wrapper {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        svg {
            background: #1a1a1a;
            border: 1px solid #444;
        }
        .radar-grid circle {
            fill: none;
            stroke: rgba(185, 173, 255, 0.3);
            stroke-width: 1;
        }
        .radar-axes line {
            stroke: rgba(185, 173, 255, 0.2);
            stroke-width: 1;
        }
        .score-polygon {
            fill: rgba(185, 173, 255, 0.2);
            stroke: rgba(185, 173, 255, 0.8);
            stroke-width: 2;
        }
        .score-dot {
            stroke: white;
            stroke-width: 2;
        }
        .radar-labels text {
            fill: #b9adff;
            font-size: 12px;
            text-anchor: middle;
        }
        .axis-labels text {
            fill: #888;
            font-size: 13px;
            font-style: italic;
        }
        .cartesian-grid line {
            stroke: #666;
            stroke-width: 2;
        }
        .debug-info {
            background: #333;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 14px;
        }
        .circle-marker {
            fill: none;
            stroke: yellow;
            stroke-width: 3;
            stroke-dasharray: 5, 5;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Radar Chart Debug: Code 0030</h1>
        <p>Profile: I:15 S:26 P:8 C:32 A:10 G:32</p>

        <div class="debug-info">
            <h3>Expected Behavior:</h3>
            <p>• Min score (P:8) should land on 2nd circle (40% radius = 72px)</p>
            <p>• Max score (C:32 or G:32) should land on 5th circle (100% radius = 180px)</p>
            <p>• Yellow dashed circle shows the 2nd circle (40% = 72px radius)</p>
        </div>

        <div class="chart-wrapper">
            <h3>6-Axis Chart (with A and G)</h3>
            <svg id="chart6" viewBox="0 0 500 500" width="500" height="500"></svg>
        </div>

        <div class="chart-wrapper">
            <h3>4-Axis Chart (archetypes only)</h3>
            <svg id="chart4" viewBox="0 0 500 500" width="500" height="500"></svg>
        </div>

        <div class="debug-info" id="calculations"></div>
    </div>

    <script>
        const scores = { I: 15, S: 26, P: 8, C: 32, A: 10, G: 32 };
        const CENTER_X = 250;
        const CENTER_Y = 250;
        const MAX_RADIUS = 180;
        const GRID_LEVELS = 5;

        function createSVGElement(type, attrs = {}) {
            const el = document.createElementNS('http://www.w3.org/2000/svg', type);
            Object.entries(attrs).forEach(([k, v]) => el.setAttribute(k, v));
            return el;
        }

        function drawGrid(svg, centerX, centerY, maxRadius, levels) {
            const g = createSVGElement('g', { class: 'radar-grid' });
            for (let i = 1; i <= levels; i++) {
                const r = (i / levels) * maxRadius;
                g.appendChild(createSVGElement('circle', { cx: centerX, cy: centerY, r }));
            }
            svg.appendChild(g);

            // Highlight the 2nd circle (40%)
            const highlight = createSVGElement('circle', {
                cx: centerX,
                cy: centerY,
                r: 72,
                class: 'circle-marker'
            });
            svg.appendChild(highlight);
        }

        function drawAxes(svg, axes, centerX, centerY, maxRadius) {
            const g = createSVGElement('g', { class: 'radar-axes' });
            axes.forEach(axis => {
                const rad = (axis.angle * Math.PI) / 180;
                const x2 = centerX + maxRadius * Math.cos(rad);
                const y2 = centerY + maxRadius * Math.sin(rad);
                g.appendChild(createSVGElement('line', { x1: centerX, y1: centerY, x2, y2 }));
            });
            svg.appendChild(g);
        }

        function drawCartesian(svg, centerX, centerY, maxRadius) {
            const g = createSVGElement('g', { class: 'cartesian-grid' });
            g.appendChild(createSVGElement('line', {
                x1: centerX - maxRadius, y1: centerY,
                x2: centerX + maxRadius, y2: centerY
            }));
            g.appendChild(createSVGElement('line', {
                x1: centerX, y1: centerY - maxRadius,
                x2: centerX, y2: centerY + maxRadius
            }));
            svg.appendChild(g);

            const labels = createSVGElement('g', { class: 'axis-labels' });
            const text1 = createSVGElement('text', { x: centerX, y: centerY - maxRadius - 15, 'text-anchor': 'middle' });
            text1.textContent = 'Top-down';
            const text2 = createSVGElement('text', { x: centerX, y: centerY + maxRadius + 25, 'text-anchor': 'middle' });
            text2.textContent = 'Bottom-up';
            const text3 = createSVGElement('text', { x: 25, y: centerY + 5, 'text-anchor': 'start' });
            text3.textContent = 'Reflection';
            const text4 = createSVGElement('text', { x: 475, y: centerY + 5, 'text-anchor': 'end' });
            text4.textContent = 'Expression';
            labels.append(text1, text2, text3, text4);
            svg.appendChild(labels);
        }

        function calculatePoints(axes, scores, centerX, centerY, maxRadius) {
            const allScores = axes.map(axis => scores[axis.key]);
            const maxScore = Math.max(...allScores);
            const minScore = Math.min(...allScores);

            return axes.map(axis => {
                const score = scores[axis.key];
                const normalizedScore = (score - minScore) / (maxScore - minScore);
                const paddedScore = normalizedScore * 0.6 + 0.4;
                const radius = paddedScore * maxRadius;

                const rad = (axis.angle * Math.PI) / 180;
                const x = centerX + radius * Math.cos(rad);
                const y = centerY + radius * Math.sin(rad);
                return { x, y, score, label: axis.label, radius, paddedScore };
            });
        }

        function drawPolygon(svg, points, axes) {
            const g = createSVGElement('g', { class: 'radar-data' });

            const polygon = createSVGElement('polygon', {
                points: points.map(p => `${p.x},${p.y}`).join(' '),
                class: 'score-polygon'
            });
            g.appendChild(polygon);

            points.forEach((p, i) => {
                const colors = {
                    'I': '#f39c12', 'S': '#5dbcd2', 'P': '#e74c3c',
                    'C': '#9b59b6', 'A': '#5dbcd2', 'G': '#27ae60'
                };
                const circle = createSVGElement('circle', {
                    cx: p.x, cy: p.y, r: 6,
                    class: 'score-dot',
                    fill: colors[axes[i].key] || '#b9adff'
                });
                g.appendChild(circle);
            });

            svg.appendChild(g);
        }

        function drawLabels(svg, axes, centerX, centerY, maxRadius) {
            const g = createSVGElement('g', { class: 'radar-labels' });
            axes.forEach(axis => {
                const rad = (axis.angle * Math.PI) / 180;
                const x = centerX + (maxRadius + 50) * Math.cos(rad);
                const y = centerY + (maxRadius + 50) * Math.sin(rad);
                const text = createSVGElement('text', { x, y });
                text.textContent = axis.label;
                g.appendChild(text);
            });
            svg.appendChild(g);
        }

        // 6-axis chart
        const axes6 = [
            { key: 'A', label: 'Architect', angle: -90 },
            { key: 'P', label: 'Producer', angle: -30 },
            { key: 'C', label: 'Creative', angle: 30 },
            { key: 'G', label: 'Gardener', angle: 90 },
            { key: 'I', label: 'Inner Guide', angle: 150 },
            { key: 'S', label: 'Synthesizer', angle: 210 }
        ];

        const svg6 = document.getElementById('chart6');
        drawGrid(svg6, CENTER_X, CENTER_Y, MAX_RADIUS, GRID_LEVELS);
        drawAxes(svg6, axes6, CENTER_X, CENTER_Y, MAX_RADIUS);
        const points6 = calculatePoints(axes6, scores, CENTER_X, CENTER_Y, MAX_RADIUS);
        drawPolygon(svg6, points6, axes6);
        drawLabels(svg6, axes6, CENTER_X, CENTER_Y, MAX_RADIUS);

        // 4-axis chart
        const axes4 = [
            { key: 'S', label: 'Synthesizer', angle: -135 },
            { key: 'P', label: 'Producer', angle: -45 },
            { key: 'C', label: 'Creative', angle: 45 },
            { key: 'I', label: 'Inner Guide', angle: 135 }
        ];

        const svg4 = document.getElementById('chart4');
        drawGrid(svg4, CENTER_X, CENTER_Y, MAX_RADIUS, GRID_LEVELS);
        drawCartesian(svg4, CENTER_X, CENTER_Y, MAX_RADIUS);
        drawAxes(svg4, axes4, CENTER_X, CENTER_Y, MAX_RADIUS);
        const points4 = calculatePoints(axes4, scores, CENTER_X, CENTER_Y, MAX_RADIUS);
        drawPolygon(svg4, points4, axes4);
        drawLabels(svg4, axes4, CENTER_X, CENTER_Y, MAX_RADIUS);

        // Debug output
        const calc = document.getElementById('calculations');
        calc.innerHTML = `
            <h3>6-Axis Calculations:</h3>
            ${points6.map(p => `<p>${p.label}: score=${p.score}, padded=${p.paddedScore.toFixed(3)}, radius=${p.radius.toFixed(1)}px</p>`).join('')}
            <h3>4-Axis Calculations:</h3>
            ${points4.map(p => `<p>${p.label}: score=${p.score}, padded=${p.paddedScore.toFixed(3)}, radius=${p.radius.toFixed(1)}px</p>`).join('')}
            <h3>Circle Radii:</h3>
            <p>Circle 1: 36px (20%)</p>
            <p>Circle 2: 72px (40%) ← Min score should be here</p>
            <p>Circle 3: 108px (60%)</p>
            <p>Circle 4: 144px (80%)</p>
            <p>Circle 5: 180px (100%) ← Max score should be here</p>
        `;
    </script>
</body>
</html>
